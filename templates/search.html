<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/search.css') }}">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <form action="/predict" method="post">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <div class="modaltitle">
                          <h5 class="modal-title" id="exampleModalLabel">Prediction Requirements</h5>
                      </div>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true"><i class="bi bi-x-circle"></i></span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <div class="modalmain">
                          <div class="div">
                              <div class="input-icon">
                                  <input type="text" placeholder="Enter Rainfall (in mm)" name="rain">
                                  <i class="icon"><i class="bi bi-cloud-rain"></i></i>
                              </div>
                              <div class="input-icon">
                                  <input type="text" placeholder="Enter Humidity (in %)" name="humi">
                                  <i class="icon"><i class="bi bi-moisture"></i></i>
                              </div>
                              <div class="input-icon">
                                  <input type="text" placeholder="Enter PH level" name="ph">
                                  <i class="icon"><i class="bi bi-droplet"></i></i>
                              </div>
                              <div class="input-icon  input1">
                                  <input type="text" placeholder="Enter Temperature (in Â°C)" name="temp">
                                  <i class="icon"><i class="bi bi-sun"></i></i>
                              </div>
                            </div>
                      </div>
                  </div>
                  <div class="btn-div1"> <button type="submit" class="colorbtn1 btn btn-success iconbtn text-white">Predict  &nbsp;<i class="bi bi-arrow-right larger-icon"></i></button> </div>
              </div>
          </div>
      </form>
  </div>
  <!-- Modal -->
    <nav class="navbar navbar-light navbar-transparent">
      <a class="navbar-brand" href="{{ url_for('index') }}"
        ><img src="{{ url_for('static', filename='images/cropickk.svg') }}" alt="" class="shift-right"
      /></a>
    </nav>
    <div class="search">
      <form action="/autopredict" method="post">
        <div class="search">
          <div class="search-icon">
            <div class="icon"><i class="bi bi-search"></i></div>
            <div class="inputfield">
              <select class="form-select inputsearch" aria-label="Default select example" name="place">
                <option selected>Select a place</option>
                <option value="Thimphu">Thimphu</option>
                  <option value="Paro dzongkhag">Paro</option>
                  <option value="Haa dzongkhag">Haa</option>
                  <option value="wang dzongkhag">Punakha</option>
                  <option value="Samdrup dzongkhag">Samdrupjongkhar</option>
                  <option value="Gasa dzongkhag">Gasa</option>
                  <option value="wang dzongkhag">Wangduephodrang</option>
                  <option value="dagana dzongkhag">Dagana</option>
                  <option value="Chukha dzongkhag">Chukha</option>
                  <option value="samtse dzongkhag">Samtse</option>
                  <option value="Tsirang dzongkhag">Tsirang</option>
                  <option value="Sarpang dzongkhag">Sarpang</option>
                  <option value="pemagatsel dzongkhag">Pemagatshel</option>
                  <option value="Tashigang dzongkhag">Transhigang</option>
                  <option value="Tashi dzongkhag">Transhiyangtse</option>
                  <option value="Lhuentse dzongkhag">Lhuentse</option>
                  <option value="Bumthang dzongkhag">Bumthang</option>
                  <option value="Zhemgang dzongkhag">Zhemgang</option>
                  <option value="trongsa dzongkhag">Trongsa</option>
                  <option value="Mongar">Mongar</option>
              </select>
            </div>
          </div>
          <div class="btn-div">
            <button type="submit" class="btn btn-success">Auto-Predict</button>
          </div>
          <div class="btn-div">
            <button type="button" class="btn btn-outline-success" data-toggle="modal" data-target="#exampleModal">
              Manual Input
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="content">
      <div class="predres">
        <div class="resultss">
          <h1>Prediction results</h1>
        </div>
        <!-- <div class="details">
        Latitude: <span id="latitude"></span> | Longitude: <span id="longitude"></span>
        
        </div> -->
        {% for item in data %}
        <div class="list">
          <div class="image">
            <!-- <img src="{{ url_for('static', filename='images/image 121.svg') }}"/> -->
            <img src="{{ url_for('static', filename='uploads/' + item.filename) }}" alt="Image" class="roundhouse">
          </div>
          <div class="name">
            {{ item.name }}
            <div class="descr">
              {{ item.description }}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <script>
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          console.log('Geolocation is not supported by this browser.');
        }
      }
  
      function showPosition(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;
  
        document.getElementById('latitude').innerHTML = latitude;
        document.getElementById('longitude').innerHTML = longitude;
  
        getLocationName(latitude, longitude);
        getAltitude(latitude, longitude);
        getWeatherData(latitude, longitude);
      }
  
      function getLocationName(latitude, longitude) {
        var url = 'https://nominatim.openstreetmap.org/reverse?format=json&lat=' + latitude + '&lon=' + longitude;
  
        $.getJSON(url, function(data) {
          var district = data.address.county;
          document.getElementById('district').innerHTML = district;
        });
      }
  
      function getAltitude(latitude, longitude) {
        var url = 'https://api.open-elevation.com/api/v1/lookup?locations=' + latitude + ',' + longitude;
  
        $.getJSON(url, function(data) {
          var altitude = data.results[2].elevation;
          document.getElementById('altitude').innerHTML = altitude;
        });
      }
  
      function getWeatherData(latitude, longitude) {
        var apiKey = '63746ddd3e46493328fd256f0846aa87';
        var url = 'https://api.openweathermap.org/data/2.5/weather?lat=' + latitude + '&lon=' + longitude + '&appid=' + apiKey;
  
        $.getJSON(url, function(data) {
          var humidity = data.main.humidity;
          var temperature = data.main.temp - 273.15; // Convert temperature to Celsius
  
          document.getElementById('humidity').innerHTML = humidity;
          document.getElementById('temperature').innerHTML = temperature.toFixed(2);
        });
      }
  
      getLocation();
    </script>
  </body>
</html>
